repos:
  # Secret Detection
  # NOTE: Do NOT use --all-files flag - it scans entire repo and can hang!
  # Pre-commit automatically scans only staged files, which is correct behavior.
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        args: ["--baseline", ".secrets.baseline"]
        # Optional: Add --max-file-size if scans are slow
        # args: ["--baseline", ".secrets.baseline", "--max-file-size", "100000"]
        exclude: |
          (?x)^(
            \.env\.example|
            docs/.*\.md$|
            .*_COMPLETE\.md$|
            .*_REPORT\.md$|
            tests/.*|
            \.secrets\.baseline
          )$
        # Add timeout protection (requires pre-commit 2.18+)
        # If a scan takes longer than 5 minutes, it will be killed
        verbose: true

  # Python Code Quality (existing Bandit integration)
  - repo: https://github.com/PyCQA/bandit
    rev: 1.8.6
    hooks:
      - id: bandit
        args: ["-c", "pyproject.toml"]
        additional_dependencies: ["bandit[toml]"]

  # Python formatting with Black
  - repo: https://github.com/psf/black
    rev: 25.9.0
    hooks:
      - id: black
        language_version: python3.11
        exclude: ^(venv/|\.venv/)

  # Custom pre-commit checks (from existing template)
  - repo: local
    hooks:
      - id: file-size-check
        name: Check file sizes and conventions
        entry: scripts/pre-commit.template
        language: script
        pass_filenames: false
        always_run: true

      - id: naming-convention-compliance
        name: Check API key naming convention compliance
        entry: pytest tests/test_code_naming_convention.py -q --tb=line
        language: system
        pass_filenames: false
        stages: [pre-commit]
        files: \.py$

      - id: organization-enforcement
        name: Enforce repository organization rules
        entry: python3 scripts/enforce_organization.py --check-root
        language: system
        pass_filenames: false
        stages: [pre-commit]
