# File Management Integration Plan

**Purpose**: Integrate existing archiving workflows into AI session management and document the automated file creation system
**Status**: Planning
**Created**: 2025-10-11
**Last Updated**: 2025-10-11

---

## 🎯 Executive Summary

This plan integrates proactive file management into the existing context optimization system by:
1. **Documenting** the existing script-based file creation system
2. **Enhancing** current automation scripts with archive awareness
3. **Training** Claude/AI on when to use scripts vs. manual file creation
4. **Monitoring** file proliferation through existing health check systems

**Key Principle**: Work WITH the existing system, don't create parallel patterns.

---

## 📊 Current State Analysis

### Existing Automated System (DO NOT RECREATE)

**Auto-Generated Files** (NEVER manually edit):
- `.ai/current-session.md` - Generated by `scripts/session_start.sh`
- Benchmark/test results - Generated by test scripts
- Reports - Generated by reporting scripts

**Script-Based File Creation**:
- `scripts/session_start.sh` - Creates current-session.md, optionally creates daily session files
- `scripts/session_archive.sh` - Archives old session files to local/S3
- `scripts/auto_archive.sh` - Archives completion documents
- `scripts/update_status.sh` - Updates PROJECT_STATUS.md
- `scripts/checkpoint_session.sh` - Creates session checkpoints
- `scripts/update_current_session.sh` - Updates current session state

**Template-Based Creation**:
- `.ai/daily/template.md` - Template for daily sessions
- `.ai/monthly/template.md` - Template for monthly summaries
- `.ai/permanent/template.md` - Template for ADRs

### What's Working Well

✅ Session management is fully automated
✅ Archive scripts exist and work
✅ Templates ensure consistency
✅ Scripts preserve git history
✅ Root directory reduced from ~25 to 11 markdown files

### What Needs Improvement

❌ Claude/AI doesn't know which files are auto-generated
❌ No documentation of script-based file creation patterns
❌ Archive scripts not integrated into daily workflow
❌ No warnings when file count grows
❌ Unclear when to use scripts vs. manual creation

---

## 🎯 Goals & Success Criteria

### Primary Goals

1. **Document the existing system** so Claude/AI understands it
2. **Enhance existing scripts** with archive awareness
3. **Integrate archiving** into daily/weekly workflows
4. **Prevent file proliferation** through proactive monitoring

### Success Metrics

**Immediate (1 week)**:
- ✅ Phase 1 complete: 5 documents archived (DONE)
- ✅ Existing system documented in 3 key locations
- ✅ Claude/AI aware of auto-generated files
- ✅ File creation decision tree added to START_HERE

**Short-term (2 weeks)**:
- ✅ session_start.sh enhanced with archive warnings
- ✅ auto_archive.sh bug fixed and reporting added
- ✅ weekly_health_check.sh includes archive metrics
- ✅ Root directory maintained at <15 markdown files

**Long-term (ongoing)**:
- ✅ Zero manual edits to auto-generated files
- ✅ Archive runs automatically weekly
- ✅ File count stays under thresholds
- ✅ Context budget maintained at 3-10K tokens/session

---

## 📋 Implementation Phases

### Phase 1: ✅ COMPLETE - Immediate Cleanup

**Status**: Complete (5 documents archived)

**Completed**:
- ✅ Archived 5 completion documents to `docs/archive/2025-10/completion/`
- ✅ Updated archive index
- ✅ Root directory reduced to 11 markdown files

---

### Phase 2: Document the Existing System

**Goal**: Make Claude/AI aware of the automated file creation system

#### Task 2.1: Update START_HERE_FOR_CLAUDE.md

**Add new section: "Automated File Creation System"**

```markdown
## 🤖 Automated File Creation System

### Files That Are AUTO-GENERATED (Never Edit Manually)

- `.ai/current-session.md` - Generated by `./scripts/session_start.sh`
- `PROJECT_STATUS.md` - Updated by `./scripts/update_status.sh`
- Test/benchmark results - Generated by test scripts

### When to Use Scripts vs. Manual Creation

**Use Scripts For**:
1. Starting sessions: `./scripts/session_start.sh`
2. Creating daily logs: `./scripts/session_start.sh --new-session`
3. Archiving old files: `./scripts/auto_archive.sh`
4. Updating status: `./scripts/update_status.sh`

**Manual Creation OK For**:
- New guides in `docs/guides/` (after checking DOCUMENTATION_MAP.md)
- Editing sections in `project/status/*.md`
- Creating new analysis documents

### File Creation Decision Flow

1. **Check if auto-generated** → Don't edit, use script instead
2. **Check for existing script** → Use script if available
3. **Check DOCUMENTATION_MAP.md** → Update existing if canonical location exists
4. **Follow decision tree** → See below for full tree
```

**Files affected**:
- `START_HERE_FOR_CLAUDE.md` - Add automation awareness (50-75 lines)

#### Task 2.2: Enhance CONTEXT_OPTIMIZATION_OPERATIONS_GUIDE.md

**Add new section after "Information Storage Hierarchy"**:

```markdown
## 🤖 Automated File Management System

### Understanding the Automation

This project uses **script-based file creation** for consistency and optimization.

### Auto-Generated Files (NEVER Edit Manually)

| File | Generator Script | Frequency | Purpose |
|------|-----------------|-----------|---------|
| `.ai/current-session.md` | `session_start.sh` | Every session | Compact session state |
| `PROJECT_STATUS.md` | `update_status.sh` | On demand | Quick status overview |
| Benchmark results | Test scripts | On test run | Performance metrics |

### Script-Based File Creation Patterns

**Pattern 1: Session Files**
```bash
# Generate current-session.md
./scripts/session_start.sh

# Create new daily session file (optional)
./scripts/session_start.sh --new-session
```

**Pattern 2: Archiving**
```bash
# Archive completion documents
./scripts/auto_archive.sh

# Archive old sessions to S3
./scripts/session_archive.sh --to-s3
```

**Pattern 3: Status Updates**
```bash
# Regenerate PROJECT_STATUS.md
./scripts/update_status.sh
```

### When Scripts Are NOT Available

**Fallback to Manual Creation**:
1. Check `docs/DOCUMENTATION_MAP.md` for canonical location
2. Follow 7-step decision tree
3. Update relevant index files
4. Cross-reference instead of duplicating

**Example: Creating New Guide**
```bash
# 1. Check if location exists
cat docs/DOCUMENTATION_MAP.md | grep "topic"

# 2. Create in appropriate location
vim docs/guides/NEW_TOPIC_GUIDE.md

# 3. Update index
vim docs/guides/index.md

# 4. Add to documentation map
vim docs/DOCUMENTATION_MAP.md
```
```

**Files affected**:
- `CONTEXT_OPTIMIZATION_OPERATIONS_GUIDE.md` - Add automated system section (100-150 lines)

#### Task 2.3: Revise .ai/permanent/file-management-policy.md

**Already created, but needs revision to reflect reality**:
- Update "Directory Structure" section to mark auto-generated files
- Add "Script-Based File Creation" section at top
- Document which scripts create which files
- Remove contradictions with existing system

**Files affected**:
- `.ai/permanent/file-management-policy.md` - Revise to match existing system (minor edits)

#### Task 2.4: Create docs/guides/FILE_CREATION_DECISION_TREE.md

**New comprehensive visual guide**:

```markdown
# File Creation Decision Tree

**Purpose**: Complete guide for when to use scripts, when to create manually
**Audience**: Claude/AI sessions, developers

## 🔍 Before Creating ANY File

```
┌─────────────────────────────────────────────┐
│ STEP 0: Is this file auto-generated?       │
└─────────────────────────────────────────────┘
           │
           ├─ YES → Use the generator script
           │         Don't edit manually
           │         Examples: current-session.md, PROJECT_STATUS.md
           │
           └─ NO → Continue to Step 1
                   │
┌─────────────────────────────────────────────┐
│ STEP 1: Is there a script that creates     │
│         this type of file?                  │
└─────────────────────────────────────────────┘
           │
           ├─ YES → Use the script
           │         Examples:
           │         - ./scripts/session_start.sh --new-session
           │         - ./scripts/auto_archive.sh
           │
           └─ NO → Continue to Step 2
                   │
┌─────────────────────────────────────────────┐
│ STEP 2: Does canonical location exist?     │
│         (Check docs/DOCUMENTATION_MAP.md)   │
└─────────────────────────────────────────────┘
           │
           ├─ YES → Update existing file
           │         Don't create new one
           │
           └─ NO → Continue to Step 3
                   │
[Continue with 7-step decision tree from existing docs...]
```
```

**Files affected**:
- `docs/guides/FILE_CREATION_DECISION_TREE.md` - NEW file (200-300 lines)

**Estimated effort**: 3-4 hours

---

### Phase 3: Enhance Existing Automation Scripts

**Goal**: Add archive awareness to existing workflow

#### Task 3.1: Fix and Enhance auto_archive.sh

**Bug Fix**:
- Line 262: Fix "local can only be used in a function" error

**Enhancements**:
1. Add reporting mode: `--report` flag shows what would be archived
2. Add statistics: Show files archived, root directory count before/after
3. Add token savings estimate: Show context tokens saved

**Example output**:
```
Archive Report
===============
Would archive: 3 files
- SPRINT_5_COMPLETE.md (reason: completion document)
- VERIFICATION_REPORT.md (reason: 7+ days old)  
- OLD_SESSION.md (reason: 60+ days old)

Root directory: 15 → 12 files (-3)
Estimated context savings: ~1,500 tokens
```

**Files affected**:
- `scripts/auto_archive.sh` - Fix bug, add reporting (50-100 lines added)

#### Task 3.2: Enhance session_start.sh

**Add archive candidate detection**:

```bash
# Add after health check, before generating current-session.md

# Check for archival candidates
echo -e "${BLUE}📦 Checking for archival candidates...${NC}"

COMPLETION_DOCS=$(find . -maxdepth 1 -name "*_COMPLETE.md" -o -name "*_VERIFICATION*.md" -o -name "*_REPORT.md" -o -name "*_SUCCESS.md" | wc -l)
ROOT_MD_COUNT=$(ls -1 *.md 2>/dev/null | wc -l | tr -d ' ')

if [ "$COMPLETION_DOCS" -gt 5 ]; then
    echo -e "${YELLOW}⚠️  Found ${COMPLETION_DOCS} completion documents in root${NC}"
    echo "   Consider running: ./scripts/auto_archive.sh"
fi

if [ "$ROOT_MD_COUNT" -gt 15 ]; then
    echo -e "${YELLOW}⚠️  Root directory has ${ROOT_MD_COUNT} markdown files (target: <15)${NC}"
    echo "   Consider archiving old documentation"
fi
```

**Files affected**:
- `scripts/session_start.sh` - Add archive check (20-30 lines added)

#### Task 3.3: Enhance weekly_health_check.sh

**Add archive metrics section**:

```bash
# Add new check section
echo ""
echo -e "${BOLD}${BLUE}7. Archive & File Management${NC}"
echo "─────────────────────────────────────"

# Check root directory file count
ROOT_MD_COUNT=$(ls -1 *.md 2>/dev/null | wc -l | tr -d ' ')
TARGET_COUNT=15

if [[ $ROOT_MD_COUNT -le $TARGET_COUNT ]]; then
    record_check "PASS" "Root directory: ${ROOT_MD_COUNT} files (target: <${TARGET_COUNT})"
elif [[ $ROOT_MD_COUNT -le $((TARGET_COUNT + 5)) ]]; then
    record_check "WARN" "Root directory: ${ROOT_MD_COUNT} files (approaching limit)"
else
    record_check "FAIL" "Root directory: ${ROOT_MD_COUNT} files (exceeds target)"
fi

# Check for completion documents
COMPLETION_DOCS=$(find . -maxdepth 1 -name "*_COMPLETE.md" -o -name "*_VERIFICATION*.md" | wc -l)
if [[ $COMPLETION_DOCS -eq 0 ]]; then
    record_check "PASS" "No unarchived completion documents"
elif [[ $COMPLETION_DOCS -le 3 ]]; then
    record_check "WARN" "${COMPLETION_DOCS} completion document(s) to archive"
else
    record_check "FAIL" "${COMPLETION_DOCS} completion documents need archiving"
fi
```

**Files affected**:
- `scripts/weekly_health_check.sh` - Add archive metrics (40-50 lines added)

**Estimated effort**: 2-3 hours

---

### Phase 4: Documentation Updates

**Goal**: Ensure all documentation references the automated system

#### Task 4.1: Update docs/DOCUMENTATION_MAP.md

**Add new section**: "Auto-Generated Files & Scripts"

```markdown
### Auto-Generated Files & Scripts
| File | Generator | Purpose | Edit? |
|------|-----------|---------|-------|
| `.ai/current-session.md` | `session_start.sh` | Session state | ❌ Never |
| `PROJECT_STATUS.md` | `update_status.sh` | Quick status | ⚠️ Via script only |
| Daily session files | `session_start.sh --new-session` | Detailed logs | ✅ After creation |
| Test results | Test scripts | Performance data | ❌ Never |
```

**Files affected**:
- `docs/DOCUMENTATION_MAP.md` - Add auto-generated section (30-50 lines)

#### Task 4.2: Update docs/guides/CONTEXT_BUDGET_GUIDE.md

**Add section**: "Automated File Management Impact"

```markdown
## Automated File Management Impact

### Token Savings from Automation

| Operation | Manual | Automated | Savings |
|-----------|--------|-----------|---------|
| Session start | 5,000+ | 300 | 94% |
| Status update | 1,000+ | 50 | 95% |
| Archive check | 500+ | 10 | 98% |

### Why Scripts Save Context

1. **Generated files are optimized** - Only include necessary information
2. **No need to read** - Scripts handle file creation
3. **Consistent format** - Predictable structure = less parsing
4. **Automatic cleanup** - Archives remove old files from context
```

**Files affected**:
- `docs/guides/CONTEXT_BUDGET_GUIDE.md` - Add automation impact (50-75 lines)

#### Task 4.3: Update .ai/permanent/index.md

**Add reference to file-management-policy.md**:

```markdown
### Reference Materials

- **[tool-registry.md](tool-registry.md)** - Searchable list of all 90+ tools
- **[file-management-policy.md](file-management-policy.md)** - File organization & archiving policy
- **[context_budget.json](context_budget.json)** - Budget configuration
```

**Files affected**:
- `.ai/permanent/index.md` - Add reference (5-10 lines)

**Estimated effort**: 1-2 hours

---

### Phase 5: Monitoring & Enforcement

**Goal**: Maintain system health through automation

#### Task 5.1: Add file count monitoring to monitor_file_sizes.sh

**Enhance existing script** with file count checks:

```bash
# Add after file size checks
echo ""
echo "File Count Monitoring"
echo "====================="

# Root directory
ROOT_COUNT=$(ls -1 *.md 2>/dev/null | wc -l)
echo "Root markdown files: $ROOT_COUNT (target: <15)"

if [ $ROOT_COUNT -gt 20 ]; then
    echo "ERROR: Root directory exceeds 20 files"
    EXIT_CODE=1
elif [ $ROOT_COUNT -gt 15 ]; then
    echo "WARNING: Root directory exceeds 15 files"
fi

# Active docs (excluding archives)
DOCS_COUNT=$(find docs/ -name "*.md" ! -path "*/archive/*" | wc -l)
echo "Active documentation files: $DOCS_COUNT (target: <100)"

if [ $DOCS_COUNT -gt 150 ]; then
    echo "ERROR: Documentation exceeds 150 files"
    EXIT_CODE=1
elif [ $DOCS_COUNT -gt 100 ]; then
    echo "WARNING: Documentation exceeds 100 files"
fi
```

**Files affected**:
- `scripts/monitor_file_sizes.sh` - Add file count monitoring (30-40 lines)

#### Task 5.2: Add archive metrics to context_dashboard.sh

**Enhance dashboard** with archive information:

```bash
# Add archive metrics section
echo ""
echo "Archive Metrics"
echo "==============="

ARCHIVED_THIS_WEEK=$(find docs/archive/2025-10/ -name "*.md" -mtime -7 | wc -l)
ROOT_FILES=$(ls -1 *.md 2>/dev/null | wc -l)
COMPLETION_DOCS=$(find . -maxdepth 1 -name "*_COMPLETE.md" | wc -l)

echo "Files archived this week: $ARCHIVED_THIS_WEEK"
echo "Root directory files: $ROOT_FILES (target: <15)"
echo "Completion docs to archive: $COMPLETION_DOCS"

# Color-coded status
if [ $ROOT_FILES -le 15 ]; then
    echo -e "${GREEN}Status: Healthy${NC}"
elif [ $ROOT_FILES -le 20 ]; then
    echo -e "${YELLOW}Status: Warning${NC}"
else
    echo -e "${RED}Status: Critical - Run auto_archive.sh${NC}"
fi
```

**Files affected**:
- `scripts/context_dashboard.sh` - Add archive metrics (30-40 lines)

**Estimated effort**: 1-2 hours

---

## 📦 Deliverables

### Documentation
1. ✅ Updated START_HERE_FOR_CLAUDE.md with automation awareness
2. ✅ Enhanced CONTEXT_OPTIMIZATION_OPERATIONS_GUIDE.md with script-based patterns
3. ✅ Revised .ai/permanent/file-management-policy.md to match reality
4. ✅ New docs/guides/FILE_CREATION_DECISION_TREE.md
5. ✅ Updated docs/DOCUMENTATION_MAP.md with auto-generated files
6. ✅ Updated docs/guides/CONTEXT_BUDGET_GUIDE.md with automation impact

### Scripts
1. ✅ Fixed and enhanced scripts/auto_archive.sh
2. ✅ Enhanced scripts/session_start.sh with archive warnings
3. ✅ Enhanced scripts/weekly_health_check.sh with archive metrics
4. ✅ Enhanced scripts/monitor_file_sizes.sh with file counts
5. ✅ Enhanced scripts/context_dashboard.sh with archive status

### Policies
1. ✅ Clear documentation of auto-generated files
2. ✅ Script-first file creation policy
3. ✅ Archive triggers and retention policies
4. ✅ File count monitoring and thresholds

---

## 📊 Implementation Timeline

| Phase | Tasks | Effort | Duration |
|-------|-------|--------|----------|
| Phase 1 | Immediate cleanup | 30 min | ✅ Complete |
| Phase 2 | Document system | 3-4 hours | 2-3 days |
| Phase 3 | Enhance scripts | 2-3 hours | 1-2 days |
| Phase 4 | Update docs | 1-2 hours | 1 day |
| Phase 5 | Add monitoring | 1-2 hours | 1 day |
| **Total** | **All phases** | **8-12 hours** | **5-7 days** |

---

## ✅ Success Validation

### Immediate Validation (After Phase 2)
- [ ] START_HERE_FOR_CLAUDE.md includes automation section
- [ ] Claude/AI can identify auto-generated files
- [ ] File creation decision tree is clear and complete

### Short-term Validation (After Phase 3)
- [ ] session_start.sh warns about archival candidates
- [ ] auto_archive.sh runs without errors and provides reporting
- [ ] weekly_health_check.sh includes archive metrics

### Long-term Validation (Ongoing)
- [ ] Root directory stays at <15 markdown files
- [ ] No manual edits to auto-generated files
- [ ] Archive runs weekly via health check
- [ ] Context budget maintained at 3-10K tokens/session

---

## 🚨 Risk Mitigation

### Risk: Claude/AI Edits Auto-Generated Files

**Mitigation**:
- Clear documentation in START_HERE_FOR_CLAUDE.md
- Add header comments to auto-generated files: `<!-- AUTO-GENERATED - DO NOT EDIT MANUALLY -->`
- Include in file-management-policy.md

### Risk: Scripts Break Existing Workflow

**Mitigation**:
- All script enhancements are additive (no breaking changes)
- Test script changes in dry-run mode first
- Keep backups of original scripts

### Risk: File Proliferation Returns

**Mitigation**:
- Automated monitoring via weekly_health_check.sh
- Dashboard shows archive status
- session_start.sh warns early

---

## 📚 Related Documentation

- [Context Optimization Operations Guide](../../CONTEXT_OPTIMIZATION_OPERATIONS_GUIDE.md)
- [Session Management Guide](../../.ai/index.md)
- [Documentation Map](../DOCUMENTATION_MAP.md)
- [Context Budget Guide](../guides/CONTEXT_BUDGET_GUIDE.md)

---

**Plan Status**: Ready for Review
**Next Step**: Review with user, then begin Phase 2 implementation
**Estimated Completion**: 5-7 days from approval

---

**Created**: 2025-10-11
**Last Updated**: 2025-10-11
**Version**: 1.0

